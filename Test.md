## 통합 테스트

### 인터넷 연결

비록 테스트 환경을 개발환경이나 다른 환경과 구분해두었다고 하더라도, 의도치 않은 외부 웹 자원으로 연결될 수 있기에 차단해두는 것이 좋다.
[WebMock](https://github.com/bblimke/webmock)을 적용하면서 다음 메서드를 사용하면 로컬호스트 이외의 모든 연결을 차단할 수 있다.

```ruby
WebMock.disable_net_connect!(allow_localhost: true)
```

서비스에서 테스트 환경을 제공하는 경우 각 테스트에서 개별적으로 허용하면 된다.

### 요소 특정을 위한 라벨 vs 커스텀 속성

`click_on "내 버튼"` vs `find("[data-my-test]").click`

후자의 경우
* 오직 테스트를 위한 코드가 실제 코드에 들어간다.
* 실제 버튼에 사용된 라벨 대신 커스텀 속성을 사용함으로서 가독성이 떨어져, 불필요한 주석을 추가해야 해야 하기도 한다.
* click_on은 alt/title 을 지원함에도 커스텀 속성을 사용함으로써 적절한 대체 텍스트를 삽입할 기회를 놓치게 된다.
* 간혹 한 화면에 동일 이름의 버튼과 폼이 존재할 수도 있다(예: 로그인). 이 경우 click_button과 click_link를 구분해 사용하면 많은 경우 해결할 수 있다. rubocop의 경우 그래서 click_on 대신 click_button이나 click_link를 사용하도록 권장하는 cop도 존재한다.
* 실제 라벨이 사용된 테스트는 깨지기 쉽지만, 통합 테스트에서는 깨지기 쉬워도 사용자의 관점을 따라서 작성하는 테스트가 나쁘지 않다.

## trigger 보다 click 사용

Capybara의 trigger 설명을 보면, 사용자가 클릭할 수 있는지 여부와 관계없이 동작이 이뤄지는 트리거를 가능한 사용하지 않도록 지시하고 있다. flash 메시지등으로 인해 클릭이 되지 않는 문제는 실제 사용자가 경험하는 문제로, 이것을 trigger로 회피하는 것이 바람직하지 않다.


